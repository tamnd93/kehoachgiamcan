<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>K·∫ø Ho·∫°ch TƒÉng C∆° Gi·∫£m M·ª°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Be Vietnam Pro', sans-serif;
        }
        .tab-active {
            border-color: #4f46e5;
            color: #4f46e5;
            background-color: #eef2ff;
        }
        .tab-inactive {
            border-color: transparent;
            color: #4b5563;
        }
        .content-section {
            display: none;
        }
        .content-section.active {
            display: block;
        }
        details > summary {
            list-style: none;
            cursor: pointer;
        }
        details > summary::-webkit-details-marker {
            display: none;
        }
        .loading-spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-top: 4px solid #4f46e5;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-stone-50 text-stone-800">

    <div class="container mx-auto p-4 md:p-8 max-w-5xl">
        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-indigo-700">K·∫ø Ho·∫°ch TƒÉng C∆° Gi·∫£m M·ª° C·ªßa Tuy·∫øt Mi</h1>
            <p class="text-stone-600 mt-2">L·ªô tr√¨nh 4+ tu·∫ßn d√†nh cho b·∫°n, ƒë∆∞·ª£c thi·∫øt k·∫ø ƒë·ªÉ an to√†n v√† b·ªÅn v·ªØng.</p>
        </header>

        <div class="bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-4 mb-8 rounded-md" role="alert">
            <p class="font-bold">L∆∞u √Ω quan tr·ªçng</p>
            <p>Do c√≥ v·∫•n ƒë·ªÅ v·ªÅ kh·ªõp g·ªëi v√† tim, b·∫°n c·∫ßn tham kh·∫£o √Ω ki·∫øn b√°c sƒ© tr∆∞·ªõc khi b·∫Øt ƒë·∫ßu. Lu√¥n l·∫Øng nghe c∆° th·ªÉ v√† d·ª´ng l·∫°i ngay n·∫øu c·∫£m th·∫•y kh√¥ng ·ªïn.</p>
        </div>

        <div class="mb-8">
            <div class="border-b border-gray-200">
                <nav class="-mb-px flex flex-wrap justify-center gap-2 md:gap-6" aria-label="Tabs">
                    <button class="tab-btn shrink-0 border-b-2 font-medium px-3 py-2 text-sm md:text-base" data-tab="overview">T·ªïng Quan</button>
                    <button class="tab-btn shrink-0 border-b-2 font-medium px-3 py-2 text-sm md:text-base" data-tab="workouts">L·ªãch T·∫≠p</button>
                    <button class="tab-btn shrink-0 border-b-2 font-medium px-3 py-2 text-sm md:text-base" data-tab="diet">Th·ª±c ƒê∆°n</button>
                    <button class="tab-btn shrink-0 border-b-2 font-medium px-3 py-2 text-sm md:text-base" data-tab="tips">L·ªùi Khuy√™n</button>
                </nav>
            </div>
        </div>

        <main>
            <!-- Overview Section -->
            <section id="overview" class="content-section">
                <h2 class="text-2xl font-bold mb-4 text-center text-indigo-600">T·ªïng Quan & Ti·∫øn ƒê·ªô</h2>
                <div class="bg-white p-4 md:p-6 rounded-lg shadow-sm mb-6">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 text-center">
                        <div class="bg-indigo-50 p-6 rounded-lg shadow-sm">
                            <h3 class="text-lg font-semibold text-stone-500">C√¢n N·∫∑ng B·∫Øt ƒê·∫ßu</h3>
                            <p class="text-3xl font-bold text-indigo-600" id="start-weight">90<span class="text-xl">kg</span></p>
                        </div>
                        <div class="bg-indigo-50 p-6 rounded-lg shadow-sm">
                            <h3 class="text-lg font-semibold text-stone-500">M·ª•c Ti√™u</h3>
                            <p class="text-3xl font-bold text-green-600">55-60<span class="text-xl">kg</span></p>
                        </div>
                        <div class="bg-indigo-50 p-6 rounded-lg shadow-sm">
                            <h3 class="text-lg font-semibold text-stone-500">Th·ªùi Gian T·∫≠p</h3>
                            <p class="text-3xl font-bold text-indigo-600">4<span class="text-xl"> ng√†y/tu·∫ßn</span></p>
                        </div>
                    </div>
                </div>

                <div class="bg-white p-4 md:p-6 rounded-lg shadow-sm mb-6">
                    <h3 class="text-xl font-bold text-center mb-4">Theo D√µi C√¢n N·∫∑ng H√†ng Ng√†y</h3>
                    <div class="flex flex-col md:flex-row items-center justify-center gap-4 mb-4">
                        <label for="weight-input" class="sr-only">Nh·∫≠p c√¢n n·∫∑ng c·ªßa b·∫°n</label>
                        <input type="number" id="weight-input" class="flex-grow w-full md:w-auto px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Nh·∫≠p c√¢n n·∫∑ng hi·ªán t·∫°i (kg)">
                        <button id="save-weight-btn" class="w-full md:w-auto bg-indigo-600 hover:bg-indigo-700 transition duration-300 text-white font-semibold py-2 px-6 rounded-lg">L∆∞u C√¢n N·∫∑ng</button>
                    </div>
                    
                    <div class="text-center mt-4">
                        <button id="analyze-weight-btn" class="bg-green-600 hover:bg-green-700 transition duration-300 text-white font-semibold py-2 px-6 rounded-lg">Ph√¢n T√≠ch B·∫±ng AI ‚ú®</button>
                    </div>

                    <div id="analysis-message" class="mt-4 p-4 rounded-lg bg-indigo-50 text-gray-800 hidden"></div>
                    <div id="loading-analysis" class="hidden justify-center items-center mt-4">
                        <div class="loading-spinner"></div>
                        <span class="ml-2 text-stone-600">ƒêang ph√¢n t√≠ch...</span>
                    </div>
                </div>

                <div class="bg-white p-4 md:p-6 rounded-lg shadow-sm">
                    <h3 class="text-xl font-bold text-center mb-4 text-indigo-600">L·ªãch S·ª≠ C√¢n N·∫∑ng C·ªßa B·∫°n</h3>
                    <p id="loading-message" class="text-center text-stone-500">Ch∆∞a c√≥ d·ªØ li·ªáu n√†o ƒë∆∞·ª£c l∆∞u. H√£y nh·∫≠p c√¢n n·∫∑ng c·ªßa b·∫°n ƒë·ªÉ b·∫Øt ƒë·∫ßu.</p>
                    <ul id="weight-history-list" class="space-y-2"></ul>
                </div>
            </section>

            <!-- Workouts Section -->
            <section id="workouts" class="content-section">
                <h2 class="text-2xl font-bold mb-4 text-center text-indigo-600">L·ªãch T·∫≠p Luy·ªán Chi Ti·∫øt</h2>
                <p class="text-center text-stone-600 mb-8">Ch·ªçn tu·∫ßn ƒë·ªÉ xem l·ªãch t·∫≠p t∆∞∆°ng ·ª©ng. M·ªói bu·ªïi t·∫≠p ƒë∆∞·ª£c thi·∫øt k·∫ø an to√†n cho kh·ªõp g·ªëi v√† tim, t·∫≠p trung v√†o c√°c b√†i bodyweight v√† nh·∫£y d√¢y nh·∫π nh√†ng. Nh·∫•n v√†o t√™n b√†i t·∫≠p ƒë·ªÉ xem h∆∞·ªõng d·∫´n chi ti·∫øt.</p>
                <div class="flex justify-center mb-6">
                    <div class="inline-flex rounded-md shadow-sm" role="group">
                        <button type="button" class="week-btn px-4 py-2 text-sm font-medium text-gray-900 bg-white border border-gray-200 rounded-l-lg hover:bg-gray-100 focus:z-10 focus:ring-2 focus:ring-indigo-500" data-week="1">Tu·∫ßn 1 & 2</button>
                        <button type="button" class="week-btn px-4 py-2 text-sm font-medium text-gray-900 bg-white border-t border-b border-r border-gray-200 rounded-r-md hover:bg-gray-100 focus:z-10 focus:ring-2 focus:ring-indigo-500" data-week="3">Tu·∫ßn 3 & 4</button>
                    </div>
                </div>

                <div id="workout-plan"></div>
            </section>

            <!-- Diet Section -->
            <section id="diet" class="content-section">
                <h2 class="text-2xl font-bold mb-4 text-center text-indigo-600">G·ª£i √ù Th·ª±c ƒê∆°n & L·ª±a Ch·ªçn</h2>
                <p class="text-center text-stone-600 mb-8">ƒÇn ngo√†i v·∫´n c√≥ th·ªÉ l√†nh m·∫°nh! D∆∞·ªõi ƒë√¢y l√† c√°c g·ª£i √Ω ƒëa d·∫°ng v√† m·∫πo ch·ªçn m√≥n gi√∫p b·∫°n t·ªëi ƒëa h√≥a protein, ch·∫•t x∆° v√† h·∫°n ch·∫ø d·∫ßu m·ª°.</p>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="bg-white p-6 rounded-lg shadow-sm">
                        <h3 class="text-xl font-semibold mb-4 text-green-700">G·ª£i √ù Th·ª±c ƒê∆°n ƒêa D·∫°ng</h3>
                        <div class="space-y-6" id="meal-options"></div>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-sm">
                        <h3 class="text-xl font-semibold mb-4 text-green-700 text-center">Th·ª±c Ph·∫©m N√™n ƒÇn & N√™n Tr√°nh</h3>
                        <div class="space-y-4 mb-6">
                            <div>
                                <h4 class="font-bold text-lg text-green-600 mb-2">‚úÖ N√™n ƒÇn</h4>
                                <ul class="text-stone-700 space-y-1">
                                    <li>ü•© Th·ªãt n·∫°c (g√†, b√≤, l·ª£n), c√°, tr·ª©ng</li>
                                    <li>ü•ë C√°c lo·∫°i ƒë·∫≠u, h·∫°t, b∆°</li>
                                    <li>ü•¶ Rau xanh, rau c·ªß qu·∫£</li>
                                    <li>üçö Tinh b·ªôt t·ªët (g·∫°o l·ª©t, khoai lang, y·∫øn m·∫°ch)</li>
                                    <li>ü•õ S·ªØa chua kh√¥ng ƒë∆∞·ªùng, s·ªØa t∆∞∆°i t√°ch b√©o</li>
                                </ul>
                            </div>
                            <div>
                                <h4 class="font-bold text-lg text-red-600 mb-2">‚ùå N√™n Tr√°nh</h4>
                                <ul class="text-stone-700 space-y-1">
                                    <li>üçî Th·ª©c ƒÉn nhanh, ƒë·ªì chi√™n r√°n</li>
                                    <li>üç© ƒê·ªì ng·ªçt, b√°nh k·∫πo, tr√† s·ªØa</li>
                                    <li>üçú M√¨ t√¥m, ƒë·ªì ƒÉn ch·∫ø bi·∫øn s·∫µn</li>
                                    <li>üçæ ƒê·ªì u·ªëng c√≥ c·ªìn, n∆∞·ªõc ng·ªçt c√≥ ga</li>
                                    <li>üßÇ Th·ª©c ƒÉn qu√° m·∫∑n, nhi·ªÅu gia v·ªã</li>
                                </ul>
                            </div>
                        </div>
                        <div>
                            <h3 class="text-xl font-semibold mb-4 text-green-700 text-center">Tr√°i C√¢y N√™n ƒÇn & N√™n Tr√°nh</h3>
                            <div class="space-y-4">
                                <div>
                                    <h4 class="font-bold text-lg text-green-600 mb-2">‚úÖ N√™n ƒÇn</h4>
                                    <ul class="text-stone-700 space-y-1">
                                        <li>üçè T√°o, ·ªïi: Gi√†u ch·∫•t x∆°, vitamin, gi√∫p no l√¢u v√† t·ªët cho ti√™u h√≥a.</li>
                                        <li>üçä B∆∞·ªüi, cam: Ch·ª©a nhi·ªÅu vitamin C, ch·∫•t ch·ªëng oxy h√≥a v√† √≠t calo.</li>
                                        <li>üçì D√¢u t√¢y, d∆∞a h·∫•u: H√†m l∆∞·ª£ng n∆∞·ªõc cao, √≠t ƒë∆∞·ªùng, gi√∫p c·∫•p n∆∞·ªõc v√† gi·∫£i kh√°t.</li>
                                        <li>ü•ë B∆°: Gi√†u ch·∫•t b√©o kh√¥ng b√£o h√≤a ƒë∆°n l√†nh m·∫°nh, gi√∫p no l√¢u.</li>
                                    </ul>
                                </div>
                                <div>
                                    <h4 class="font-bold text-lg text-red-600 mb-2">‚ùå N√™n Tr√°nh</h4>
                                    <ul class="text-stone-700 space-y-1">
                                        <li>ü•≠ Xo√†i ch√≠n, v·∫£i, nh√£n: Ch·ª©a nhi·ªÅu ƒë∆∞·ªùng t·ª± nhi√™n, d·ªÖ g√¢y tƒÉng ƒë∆∞·ªùng huy·∫øt.</li>
                                        <li>üçå Chu·ªëi ch√≠n: C√≥ nhi·ªÅu calo h∆°n c√°c lo·∫°i tr√°i c√¢y kh√°c. N√™n ƒÉn khi c·∫ßn b·ªï sung nƒÉng l∆∞·ª£ng nhanh.</li>
                                        <li>üçà S·∫ßu ri√™ng, m√≠t: Ch·ª©a h√†m l∆∞·ª£ng ƒë∆∞·ªùng v√† calo r·∫•t cao.</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- Tips Section -->
            <section id="tips" class="content-section">
                <h2 class="text-2xl font-bold mb-4 text-center text-indigo-600">M·∫πo Duy Tr√¨ L√¢u D√†i</h2>
                <p class="text-center text-stone-600 mb-8">X√¢y d·ª±ng th√≥i quen t·ªët l√† ch√¨a kh√≥a th√†nh c√¥ng. H√£y √°p d·ª•ng nh·ªØng m·∫πo nh·ªè n√†y v√†o cu·ªôc s·ªëng h√†ng ng√†y c·ªßa b·∫°n.</p>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="bg-white p-6 rounded-lg shadow-sm flex items-start gap-4">
                        <span class="text-3xl">‚è∞</span>
                        <div>
                            <h3 class="font-bold text-lg">Chia nh·ªè b·ªØa ƒÉn</h3>
                            <p class="text-stone-600">ƒÇn 5-6 b·ªØa nh·ªè thay v√¨ 3 b·ªØa l·ªõn ƒë·ªÉ duy tr√¨ nƒÉng l∆∞·ª£ng v√† h·∫°n ch·∫ø c·∫£m gi√°c ƒë√≥i.</p>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-sm flex items-start gap-4">
                        <span class="text-3xl">üö∂‚Äç‚ôÄÔ∏è</span>
                        <div>
                            <h3 class="font-bold text-lg">TƒÉng c∆∞·ªùng v·∫≠n ƒë·ªông nh·∫π</h3>
                            <p class="text-stone-600">ƒêi b·ªô, leo c·∫ßu thang thay v√¨ ƒëi thang m√°y, d√†nh 10 ph√∫t ƒëi l·∫°i sau m·ªói gi·ªù l√†m vi·ªác.</p>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-sm flex items-start gap-4">
                        <span class="text-3xl">üßò</span>
                        <div>
                            <h3 class="font-bold text-lg">Th·ª±c h√†nh thi·ªÅn/t·∫≠p th·ªü</h3>
                            <p class="text-stone-600">Ch·ªâ 5-10 ph√∫t m·ªói ng√†y gi√∫p gi·∫£m hormone cƒÉng th·∫≥ng, tr√°nh t√≠ch m·ª° b·ª•ng.</p>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-sm flex items-start gap-4">
                        <span class="text-3xl">üìù</span>
                        <div>
                            <h3 class="font-bold text-lg">Ghi ch√©p ti·∫øn ƒë·ªô</h3>
                            <p class="text-stone-600">H√£y ghi l·∫°i c√¢n n·∫∑ng, s·ªë ƒëo v√† c·∫£m nh·∫≠n m·ªói tu·∫ßn ƒë·ªÉ theo d√µi s·ª± thay ƒë·ªïi v√† gi·ªØ ƒë·ªông l·ª±c.</p>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-sm flex items-start gap-4">
                        <span class="text-3xl">üë©‚Äç‚öïÔ∏è</span>
                        <div>
                            <h3 class="font-bold text-lg">L·∫Øng nghe c∆° th·ªÉ</h3>
                            <p class="text-stone-600">N·∫øu c·∫£m th·∫•y ƒëau ho·∫∑c m·ªát, h√£y ngh·ªâ ng∆°i. Ph·ª•c h·ªìi l√† m·ªôt ph·∫ßn quan tr·ªçng c·ªßa qu√° tr√¨nh.</p>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-sm flex items-start gap-4">
                        <span class="text-3xl">ü•∞</span>
                        <div>
                            <h3 class="font-bold text-lg">Y√™u th∆∞∆°ng b·∫£n th√¢n</h3>
                            <p class="text-stone-600">Gi·∫£m c√¢n l√† m·ªôt h√†nh tr√¨nh, kh√¥ng ph·∫£i m·ªôt cu·ªôc chi·∫øn. H√£y ki√™n nh·∫´n v√† t·ª± th∆∞·ªüng cho nh·ªØng n·ªó l·ª±c c·ªßa m√¨nh.</p>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <script>
        const STORAGE_KEY = 'fitness_plan_weight_history_vn';

        const START_WEIGHT = 90;
        const GOAL_WEIGHT_RANGE = "55-60";
        const USER_NAME = "Tuy·∫øt Mi";
        const HEALTH_CONCERNS = "v·∫•n ƒë·ªÅ v·ªÅ kh·ªõp g·ªëi v√† tim";

        const workoutData = {
            week1: {
                title: 'Tu·∫ßn 1 & 2: Giai ƒëo·∫°n l√†m quen',
                days: [
                    {
                        name: 'Ng√†y 1 & 3: Th√¢n d∆∞·ªõi & Cardio nh·∫π',
                        exercises: [
                            {
                                title: 'Kh·ªüi ƒë·ªông (10 ph√∫t)',
                                instructions: 'ƒêi b·ªô t·∫°i ch·ªó, xoay c·ªï tay c·ªï ch√¢n, xoay kh·ªõp g·ªëi nh·∫π nh√†ng, ƒë√° ch√¢n ra tr∆∞·ªõc-sau-b√™n h√¥ng.'
                            },
                            {
                                title: 'Wall Sit (ng·ªìi d·ª±a t∆∞·ªùng) - 45s',
                                instructions: 'ƒê·ª©ng d·ª±a l∆∞ng v√†o t∆∞·ªùng, t·ª´ t·ª´ h·∫° th·∫•p c∆° th·ªÉ nh∆∞ ƒëang ng·ªìi tr√™n m·ªôt chi·∫øc gh·∫ø v√¥ h√¨nh. L∆∞ng v√† m√¥ng √°p s√°t t∆∞·ªùng. Gi·ªØ ƒë·∫ßu g·ªëi m·ªôt g√≥c 90 ƒë·ªô, c·∫©n th·∫≠n kh√¥ng ƒë·ªÉ ƒë·∫ßu g·ªëi v∆∞·ª£t qu√° m≈©i ch√¢n. C·∫£m nh·∫≠n s·ª± cƒÉng c∆° ·ªü ƒë√πi. D·ª´ng l·∫°i n·∫øu th·∫•y ƒëau kh·ªõp g·ªëi.'
                            },
                            {
                                title: 'Glute Bridge (c·∫ßu h√¥ng) - 20 l·∫ßn',
                                instructions: 'N·∫±m ng·ª≠a, g·∫≠p g·ªëi, hai b√†n ch√¢n ƒë·∫∑t tr√™n s√†n. Si·∫øt ch·∫∑t c∆° m√¥ng v√† ƒë·∫©y h√¥ng l√™n cao cho ƒë·∫øn khi vai, h√¥ng v√† ƒë·∫ßu g·ªëi t·∫°o th√†nh m·ªôt ƒë∆∞·ªùng th·∫≥ng. Gi·ªØ 1-2 gi√¢y r·ªìi t·ª´ t·ª´ h·∫° xu·ªëng. H·∫°n ch·∫ø d√πng l·ª±c t·ª´ l∆∞ng d∆∞·ªõi.'
                            },
                            {
                                title: 'Standing Calf Raise (nh√≥n g√≥t) - 25 l·∫ßn',
                                instructions: 'ƒê·ª©ng th·∫≥ng, hai ch√¢n r·ªông b·∫±ng vai. T·ª´ t·ª´ nh√≥n g√≥t ch√¢n l√™n cao nh·∫•t c√≥ th·ªÉ, si·∫øt ch·∫∑t b·∫Øp ch√¢n. Gi·ªØ 1 gi√¢y r·ªìi h·∫° xu·ªëng. C√≥ th·ªÉ b√°m v√†o t∆∞·ªùng ho·∫∑c gh·∫ø ƒë·ªÉ gi·ªØ thƒÉng b·∫±ng.'
                            },
                            {
                                title: 'Jumping Jack (Low Impact) - 45s',
                                instructions: 'ƒê·ª©ng th·∫≥ng. B∆∞·ªõc ch√¢n ph·∫£i sang ngang ƒë·ªìng th·ªùi vung hai tay l√™n cao. B∆∞·ªõc ch√¢n ph·∫£i v·ªÅ, ƒë∆∞a tay v·ªÅ. ƒê·ªïi ch√¢n. L·∫∑p l·∫°i li√™n t·ª•c, ƒë√¢y l√† phi√™n b·∫£n kh√¥ng nh·∫£y ƒë·ªÉ gi·∫£m √°p l·ª±c l√™n ƒë·∫ßu g·ªëi.'
                            },
                             {
                                title: 'Nh·∫£y d√¢y nh·∫π nh√†ng - 2 ph√∫t',
                                instructions: 'Nh·∫£y d√¢y v·ªõi nh·ªãp ƒë·ªô ch·∫≠m, ch·ªâ n·∫£y nh·∫π hai ch√¢n tr√™n m·∫∑t ƒë·∫•t. Kh√¥ng c·∫ßn n√¢ng g·ªëi qu√° cao, t·∫≠p trung v√†o vi·ªác gi·ªØ nh·ªãp ƒë·ªÅu v√† h∆°i th·ªü ·ªïn ƒë·ªãnh. Ch·ªâ nh·∫£y tr√™n m≈©i b√†n ch√¢n.'
                            },
                             {
                                title: 'Plank (h√≠t th·ªü) - 45s',
                                instructions: 'Ch·ªëng khu·ª∑u tay v√† m≈©i ch√¢n xu·ªëng s√†n, gi·ªØ l∆∞ng th·∫≥ng nh∆∞ m·ªôt t·∫•m v√°n. Si·∫øt ch·∫∑t c∆° b·ª•ng v√† m√¥ng. H√≠t th·ªü s√¢u v√† ƒë·ªÅu. D·ª´ng l·∫°i n·∫øu th·∫•y l∆∞ng b·ªã v√µng.'
                            },
                            {
                                title: 'Gi√£n c∆° (10 ph√∫t)',
                                instructions: 'Gi√£n c∆° ƒë√πi tr∆∞·ªõc, ƒë√πi sau, b·∫Øp ch√¢n, h√¥ng v√† vai sau bu·ªïi t·∫≠p.'
                            }
                        ]
                    },
                    {
                        name: 'Ng√†y 2 & 4: Th√¢n tr√™n & Core',
                        exercises: [
                            {
                                title: 'Kh·ªüi ƒë·ªông (10 ph√∫t)',
                                instructions: 'T∆∞∆°ng t·ª± ng√†y 1 & 3: ƒëi b·ªô t·∫°i ch·ªó, xoay c√°c kh·ªõp.'
                            },
                            {
                                title: 'Push-ups (tr√™n t∆∞·ªùng ho·∫∑c qu·ª≥ g·ªëi) - 10-15 l·∫ßn',
                                instructions: 'Ch·ªëng tay v√†o t∆∞·ªùng ho·∫∑c ch·ªëng qu·ª≥ g·ªëi xu·ªëng s√†n. L∆∞ng th·∫≥ng. T·ª´ t·ª´ h·∫° th·∫•p ng∆∞·ªùi xu·ªëng, khu·ª∑u tay √©p s√°t ng∆∞·ªùi. ƒê·∫©y ng∆∞·ªùi l√™n tr·ªü l·∫°i. T·∫≠p trung v√†o c·∫£m gi√°c c∆° ng·ª±c v√† c∆° tay.'
                            },
                            {
                                title: 'Triceps Dip (tr√™n gh·∫ø) - 12 l·∫ßn',
                                instructions: 'Ng·ªìi tr√™n m√©p gh·∫ø, hai tay b√°m v√†o m√©p gh·∫ø, hai ch√¢n du·ªói th·∫≥ng ho·∫∑c g·∫≠p g·ªëi. Nh·∫•c m√¥ng kh·ªèi gh·∫ø, t·ª´ t·ª´ h·∫° th·∫•p c∆° th·ªÉ xu·ªëng b·∫±ng c√°ch g·∫≠p khu·ª∑u tay ra sau. Khi b·∫Øp tay song song v·ªõi s√†n, d√πng l·ª±c tay sau ƒë·∫©y ng∆∞·ªùi l√™n. Gi·ªØ l∆∞ng th·∫≥ng v√† g·∫ßn gh·∫ø.'
                            },
                            {
                                title: 'Leg Raise (n√¢ng ch√¢n) - 20 l·∫ßn',
                                instructions: 'N·∫±m ng·ª≠a, hai tay ƒë·∫∑t d∆∞·ªõi m√¥ng ƒë·ªÉ h·ªó tr·ª£ l∆∞ng. T·ª´ t·ª´ n√¢ng hai ch√¢n l√™n cho ƒë·∫øn khi vu√¥ng g√≥c v·ªõi s√†n. H·∫° ch√¢n xu·ªëng nh∆∞ng kh√¥ng ch·∫°m s√†n. L·∫∑p l·∫°i. T·∫≠p trung v√†o c∆° b·ª•ng, tr√°nh d√πng l·ª±c ·ªü l∆∞ng d∆∞·ªõi.'
                            },
                            {
                                title: 'Bird Dog (chim ch√≥) - 20 l·∫ßn',
                                instructions: 'Qu·ª≥ tr√™n hai tay v√† hai g·ªëi, gi·ªØ l∆∞ng th·∫≥ng. T·ª´ t·ª´ du·ªói th·∫≥ng m·ªôt tay v·ªÅ ph√≠a tr∆∞·ªõc v√† m·ªôt ch√¢n ƒë·ªëi di·ªán ra sau. Gi·ªØ 1 gi√¢y r·ªìi ƒë∆∞a v·ªÅ v·ªã tr√≠ ban ƒë·∫ßu. ƒê·ªïi b√™n. T·∫≠p trung v√†o gi·ªØ thƒÉng b·∫±ng v√† si·∫øt c∆° b·ª•ng.'
                            },
                            {
                                title: 'Nh·∫£y d√¢y nh·∫π nh√†ng - 2 ph√∫t',
                                instructions: 'Nh∆∞ m√¥ t·∫£ ·ªü Ng√†y 1 & 3.'
                            },
                            {
                                title: 'Plank (h√≠t th·ªü) - 45s',
                                instructions: 'Nh∆∞ m√¥ t·∫£ ·ªü Ng√†y 1 & 3.'
                            },
                             {
                                title: 'Gi√£n c∆° (10 ph√∫t)',
                                instructions: 'Gi√£n c∆° tay, vai, ng·ª±c, l∆∞ng, b·ª•ng sau bu·ªïi t·∫≠p.'
                            }
                        ]
                    }
                ]
            },
            week3: {
                title: 'Tu·∫ßn 3 & 4: Giai ƒëo·∫°n tƒÉng c∆∞·ªùng',
                days: [
                     {
                        name: 'Ng√†y 1 & 3: Th√¢n d∆∞·ªõi & Cardio',
                        exercises: [
                            {
                                title: 'Kh·ªüi ƒë·ªông (10 ph√∫t)',
                                instructions: 'T∆∞∆°ng t·ª± nh∆∞ c√°c tu·∫ßn tr∆∞·ªõc.'
                            },
                            {
                                title: 'Wall Sit (ng·ªìi d·ª±a t∆∞·ªùng) - 60s',
                                instructions: 'TƒÉng th·ªùi gian gi·ªØ t∆∞ th·∫ø. N·∫øu ƒëau g·ªëi, c√≥ th·ªÉ gi·∫£m th·ªùi gian ho·∫∑c ch·ªâ ng·ªìi ·ªü g√≥c 45 ƒë·ªô.'
                            },
                            {
                                title: 'Glute Bridge (c·∫ßu h√¥ng) - 25 l·∫ßn',
                                instructions: 'TƒÉng s·ªë l·∫ßn l·∫∑p l·∫°i. C·ªë g·∫Øng si·∫øt m√¥ng ·ªü ƒë·ªânh ƒë·ªông t√°c th·∫≠t ch·∫∑t.'
                            },
                            {
                                title: 'Static Lunges (ƒë·ª©ng t·∫•n t·∫°i ch·ªó) - 12 l·∫ßn/ch√¢n',
                                instructions: 'ƒê·ª©ng th·∫≥ng, b∆∞·ªõc m·ªôt ch√¢n l√™n tr∆∞·ªõc. H·∫° th·∫•p ng∆∞·ªùi xu·ªëng cho ƒë·∫øn khi c·∫£ hai ƒë·∫ßu g·ªëi t·∫°o th√†nh g√≥c 90 ƒë·ªô. C·∫©n th·∫≠n kh√¥ng ƒë·ªÉ ƒë·∫ßu g·ªëi tr∆∞·ªõc v∆∞·ª£t qu√° m≈©i ch√¢n. ƒê·ª©ng l√™n tr·ªü l·∫°i. ƒê√¢y l√† phi√™n b·∫£n ƒë·ª©ng t·∫°i ch·ªó ƒë·ªÉ h·∫°n ch·∫ø t√°c ƒë·ªông.'
                            },
                            {
                                title: 'Nh·∫£y d√¢y - 3 ph√∫t',
                                instructions: 'TƒÉng th·ªùi gian nh·∫£y. C·ªë g·∫Øng duy tr√¨ nh·ªãp ƒë·ªô ·ªïn ƒë·ªãnh, kh√¥ng qu√° nhanh ƒë·ªÉ kh√¥ng g√¢y √°p l·ª±c l√™n tim v√† g·ªëi.'
                            },
                             {
                                title: 'Plank (h√≠t th·ªü) - 60s',
                                instructions: 'TƒÉng th·ªùi gian gi·ªØ t∆∞ th·∫ø. C·ªë g·∫Øng gi·ªØ l∆∞ng th·∫≥ng tuy·ªát ƒë·ªëi.'
                            },
                            {
                                title: 'Gi√£n c∆° (10 ph√∫t)',
                                instructions: 'Gi√£n c∆° ƒë√πi, b·∫Øp ch√¢n, h√¥ng, vai.'
                            }
                        ]
                    },
                    {
                        name: 'Ng√†y 2 & 4: Th√¢n tr√™n & Core',
                        exercises: [
                            {
                                title: 'Kh·ªüi ƒë·ªông (10 ph√∫t)',
                                instructions: 'T∆∞∆°ng t·ª± nh∆∞ c√°c tu·∫ßn tr∆∞·ªõc.'
                            },
                            {
                                title: 'Push-ups (tr√™n t∆∞·ªùng ho·∫∑c qu·ª≥ g·ªëi) - 15-20 l·∫ßn',
                                instructions: 'TƒÉng s·ªë l·∫ßn l·∫∑p l·∫°i. T·∫≠p trung v√†o k·ªπ thu·∫≠t.'
                            },
                            {
                                title: 'Leg Raise (n√¢ng ch√¢n) - 25 l·∫ßn',
                                instructions: 'TƒÉng s·ªë l·∫ßn l·∫∑p l·∫°i.'
                            },
                            {
                                title: 'Superman (si√™u nh√¢n) - 15 l·∫ßn',
                                instructions: 'N·∫±m s·∫•p, hai tay du·ªói th·∫≥ng v·ªÅ ph√≠a tr∆∞·ªõc. T·ª´ t·ª´ n√¢ng tay, ng·ª±c v√† hai ch√¢n l√™n kh·ªèi s√†n. Gi·ªØ 1 gi√¢y r·ªìi h·∫° xu·ªëng. Gi√∫p tƒÉng c∆∞·ªùng c∆° l∆∞ng d∆∞·ªõi.'
                            },
                            {
                                title: 'Nh·∫£y d√¢y - 3 ph√∫t',
                                instructions: 'Nh∆∞ m√¥ t·∫£ ·ªü Ng√†y 1 & 3.'
                            },
                             {
                                title: 'Plank (h√≠t th·ªü) - 60s',
                                instructions: 'TƒÉng th·ªùi gian gi·ªØ t∆∞ th·∫ø.'
                            },
                            {
                                title: 'Gi√£n c∆° (10 ph√∫t)',
                                instructions: 'Gi√£n c∆° tay, vai, ng·ª±c, l∆∞ng, b·ª•ng.'
                            }
                        ]
                    }
                ]
            }
        };

        const mealOptionsData = {
            breakfast: [
                { name: 'B√∫n ri√™u cua', cal: '~450', desc: 'ƒÇn nhi·ªÅu ri√™u cua, ƒë·∫≠u h≈© v√† rau. Y√™u c·∫ßu gi·∫£m b√∫n, tr√°nh t√≥p m·ª°, ri√™u cua chi√™n.' },
                { name: 'Ph·ªü b√≤', cal: '~400', desc: 'Ch·ªçn b√≤ n·∫°c, nhi·ªÅu rau gi√°. Y√™u c·∫ßu gi·∫£m m·ªôt n·ª≠a l∆∞·ª£ng b√°nh ph·ªü. Tr√°nh th√™m nhi·ªÅu t∆∞∆°ng ·ªõt.' },
                { name: 'B√∫n ch·∫£', cal: '~480', desc: 'ƒÇn nhi·ªÅu ch·∫£ n∆∞·ªõng v√† rau s·ªëng. H·∫°n ch·∫ø ch·∫£ gi√≤ chi√™n v√† n∆∞·ªõc ch·∫•m qu√° ng·ªçt.' },
                { name: 'X√¥i g√† x√©', cal: '~420', desc: 'Ch·ªçn x√¥i √≠t h√†nh phi, ƒÉn nhi·ªÅu th·ªãt g√† lu·ªôc/n∆∞·ªõng. C√≥ th·ªÉ ƒÉn k√®m d∆∞a chu·ªôt.' },
                { name: 'B√°nh m√¨ ·ªëp la', cal: '~350', desc: 'H·∫°n ch·∫ø pate v√† b∆°, ƒÉn k√®m nhi·ªÅu rau d∆∞a chu·ªôt. Ch·ªâ ƒÉn m·ªôt n·ª≠a ·ªï b√°nh m√¨.' }
            ],
            lunchDinner: [
                { name: 'C∆°m t·∫•m', cal: '~550', desc: 'Ch·ªçn s∆∞·ªùn n∆∞·ªõng, th√™m tr·ª©ng ·ªëp la ho·∫∑c b√¨. ƒÇn k√®m nhi·ªÅu d∆∞a leo v√† c√† chua. ƒÇn kho·∫£ng 1/2 ch√©n c∆°m.' },
                { name: 'B√∫n th·ªãt n∆∞·ªõng', cal: '~500', desc: 'ƒÇn nhi·ªÅu th·ªãt, ch·∫£ gi√≤ n∆∞·ªõng v√† rau s·ªëng. H·∫°n ch·∫ø ch·∫£ gi√≤ chi√™n.' },
                { name: 'G·ªèi cu·ªën/G·ªèi g√†', cal: '~300', desc: 'M·ªôt l·ª±a ch·ªçn l√Ω t∆∞·ªüng, gi√†u protein v√† ch·∫•t x∆°. H·∫°n ch·∫ø ch·∫•m nhi·ªÅu s·ªët b√©o.' },
                { name: 'C∆°m vƒÉn ph√≤ng', cal: '~500', desc: 'Ch·ªçn su·∫•t ƒÉn c√≥ nhi·ªÅu rau, m√≥n m·∫∑n l√† th·ªãt/c√° kho ho·∫∑c lu·ªôc, h·∫°n ch·∫ø ƒë·ªì chi√™n x√†o.' },
                { name: 'C√° n∆∞·ªõng/h·∫•p', cal: '~350', desc: 'ƒÇn k√®m v·ªõi c∆°m g·∫°o l·ª©t ho·∫∑c khoai lang, rau lu·ªôc. M√≥n ƒÉn n√†y √≠t calo v√† gi√†u protein.' },
                { name: 'Salad g√†/t√¥m', cal: '~300', desc: 'Ch·ªçn salad v·ªõi ·ª©c g√† ho·∫∑c t√¥m, nhi·ªÅu rau xanh. Y√™u c·∫ßu s·ªët dressing √≠t b√©o ho·∫∑c tr·ªôn d·∫ßu gi·∫•m.' }
            ],
            snacks: [
                 { name: 'S·ªØa chua kh√¥ng ƒë∆∞·ªùng', cal: '~100', desc: 'C√≥ th·ªÉ ƒÉn k√®m v·ªõi tr√°i c√¢y √≠t ng·ªçt.' },
                 { name: 'Khoai lang lu·ªôc', cal: '~150', desc: 'M·ªôt l·ª±a ch·ªçn tinh b·ªôt t·ªët, t·∫°o c·∫£m gi√°c no l√¢u.' },
                 { name: 'Tr√°i c√¢y √≠t ng·ªçt', cal: '~100-150', desc: 'T√°o, b∆∞·ªüi, ·ªïi l√† nh·ªØng l·ª±a ch·ªçn t·ªët.' },
                 { name: 'Tr·ª©ng lu·ªôc', cal: '~70', desc: 'Gi√†u protein, gi√∫p no l√¢u v√† h·∫°n ch·∫ø th√®m ƒÉn.' }
            ]
        };

        /**
         * L∆∞u l·ªãch s·ª≠ c√¢n n·∫∑ng v√†o Local Storage.
         * @param {Array} history M·∫£ng ch·ª©a c√°c ƒë·ªëi t∆∞·ª£ng c√¢n n·∫∑ng.
         */
        function saveWeightHistoryToLocal(history) {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(history));
        }

        /**
         * L·∫•y l·ªãch s·ª≠ c√¢n n·∫∑ng t·ª´ Local Storage.
         * @returns {Array} M·∫£ng ch·ª©a c√°c ƒë·ªëi t∆∞·ª£ng c√¢n n·∫∑ng, ho·∫∑c m·∫£ng r·ªóng n·∫øu kh√¥ng c√≥ d·ªØ li·ªáu.
         */
        function loadWeightHistoryFromLocal() {
            const historyJson = localStorage.getItem(STORAGE_KEY);
            return historyJson ? JSON.parse(historyJson) : [];
        }

        /**
         * Hi·ªÉn th·ªã danh s√°ch l·ªãch s·ª≠ c√¢n n·∫∑ng l√™n giao di·ªán.
         */
        function renderWeightHistory() {
            const historyList = document.getElementById('weight-history-list');
            const loadingMessage = document.getElementById('loading-message');
            
            // L·∫•y d·ªØ li·ªáu t·ª´ Local Storage
            const weightEntries = loadWeightHistoryFromLocal();

            // S·∫Øp x·∫øp theo th·ª© t·ª± th·ªùi gian gi·∫£m d·∫ßn (m·ªõi nh·∫•t l√™n tr√™n)
            weightEntries.sort((a, b) => b.timestamp - a.timestamp);
            
            if (weightEntries.length === 0) {
                loadingMessage.style.display = 'block';
                historyList.innerHTML = '';
            } else {
                loadingMessage.style.display = 'none';
                historyList.innerHTML = weightEntries.slice(0, 5).map(entry => {
                    const date = new Date(entry.timestamp);
                    const formattedDate = date.toLocaleString('vi-VN', {
                        day: '2-digit', month: '2-digit', year: 'numeric',
                        hour: '2-digit', minute: '2-digit'
                    });
                    return `<li class="flex justify-between items-center bg-gray-100 p-3 rounded-md shadow-sm">
                        <span class="font-medium">C√¢n n·∫∑ng: <strong class="text-indigo-600">${entry.weight} kg</strong></span>
                        <span class="text-sm text-stone-500">${formattedDate}</span>
                    </li>`;
                }).join('');
            }
        }

        function renderWorkoutPlan(week) {
            const planContainer = document.getElementById('workout-plan');
            const data = week === 1 ? workoutData.week1 : workoutData.week3;
            
            let html = `<h3 class="text-xl font-semibold mb-4 text-center">${data.title}</h3>`;
            html += '<div class="grid grid-cols-1 md:grid-cols-2 gap-6">';
            
            data.days.forEach(day => {
                html += `
                    <div class="bg-white p-6 rounded-lg shadow-sm">
                        <h4 class="font-bold text-lg text-indigo-700 mb-4">${day.name}</h4>
                        <div class="space-y-4">
                            ${day.exercises.map(ex => `
                                <details class="border-b border-gray-200">
                                    <summary class="flex justify-between items-center py-2">
                                        <span class="font-medium">${ex.title}</span>
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-indigo-500 transform transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                                        </svg>
                                    </summary>
                                    <p class="py-2 text-stone-600 text-sm">${ex.instructions}</p>
                                </details>
                            `).join('')}
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            planContainer.innerHTML = html;
        }

        function renderMealOptions() {
            const mealContainer = document.getElementById('meal-options');
            let html = '';
            
            const renderSection = (title, items) => {
                let sectionHtml = `<div><h4 class="font-bold text-lg text-indigo-700">${title}</h4><ul class="space-y-2 mt-2">`;
                items.forEach(item => {
                    sectionHtml += `
                        <li class="p-3 bg-indigo-50 rounded-lg">
                            <strong class="text-stone-900">${item.name}</strong> <span class="text-sm text-stone-500">(${item.cal} cal)</span>
                            <p class="text-sm text-stone-600 mt-1">${item.desc}</p>
                        </li>
                    `;
                });
                sectionHtml += `</ul></div>`;
                return sectionHtml;
            };

            html += renderSection('B·ªØa s√°ng', mealOptionsData.breakfast);
            html += renderSection('B·ªØa tr∆∞a & t·ªëi', mealOptionsData.lunchDinner);
            html += renderSection('B·ªØa ph·ª• & ƒÇn v·∫∑t', mealOptionsData.snacks);
            
            mealContainer.innerHTML = html;
        }

        document.addEventListener('DOMContentLoaded', function() {
            const tabs = document.querySelectorAll('.tab-btn');
            const contents = document.querySelectorAll('.content-section');
            const weekButtons = document.querySelectorAll('.week-btn');
            
            const saveWeightBtn = document.getElementById('save-weight-btn');
            const analyzeWeightBtn = document.getElementById('analyze-weight-btn');
            const analysisMessageDiv = document.getElementById('analysis-message');
            const loadingAnalysisDiv = document.getElementById('loading-analysis');

            function setActiveTab(tabId) {
                tabs.forEach(tab => {
                    if (tab.dataset.tab === tabId) {
                        tab.classList.add('tab-active');
                        tab.classList.remove('tab-inactive');
                    } else {
                        tab.classList.add('tab-inactive');
                        tab.classList.remove('tab-active');
                    }
                });

                contents.forEach(content => {
                    if (content.id === tabId) {
                        content.classList.add('active');
                    } else {
                        content.classList.remove('active');
                    }
                });
            }

            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    setActiveTab(tab.dataset.tab);
                });
            });
             
            weekButtons.forEach(button => {
                button.addEventListener('click', () => {
                    weekButtons.forEach(btn => btn.classList.remove('bg-indigo-200'));
                    button.classList.add('bg-indigo-200');
                    renderWorkoutPlan(parseInt(button.dataset.week));
                });
            });

            // Initial state
            setActiveTab('overview');
            renderWorkoutPlan(1);
            weekButtons[0].classList.add('bg-indigo-200');
            renderMealOptions();
            renderWeightHistory(); // Hi·ªÉn th·ªã d·ªØ li·ªáu t·ª´ Local Storage ngay khi trang t·∫£i xong
            
            async function fetchWithExponentialBackoff(url, options, retries = 5, delay = 1000) {
                try {
                    const response = await fetch(url, options);
                    if (response.status === 429 && retries > 0) {
                        await new Promise(resolve => setTimeout(resolve, delay));
                        return fetchWithExponentialBackoff(url, options, retries - 1, delay * 2);
                    }
                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(`API error: ${JSON.stringify(errorData)}`);
                    }
                    return response;
                } catch (error) {
                    if (retries > 0) {
                        await new Promise(resolve => setTimeout(resolve, delay));
                        return fetchWithExponentialBackoff(url, options, retries - 1, delay * 2);
                    }
                    throw error;
                }
            }

            async function analyzeWeightWithGemini() {
                analysisMessageDiv.classList.add('hidden');
                loadingAnalysisDiv.classList.remove('hidden');
                loadingAnalysisDiv.classList.add('flex');

                try {
                    // L·∫•y d·ªØ li·ªáu t·ª´ Local Storage
                    const weightEntries = loadWeightHistoryFromLocal();
                    
                    if (weightEntries.length < 2) {
                        analysisMessageDiv.innerHTML = '<p>Vui l√≤ng nh·∫≠p √≠t nh·∫•t hai l·∫ßn c√¢n n·∫∑ng ƒë·ªÉ c√≥ th·ªÉ ph√¢n t√≠ch.</p>';
                        analysisMessageDiv.classList.remove('hidden');
                        return;
                    }
                    weightEntries.sort((a, b) => a.timestamp - b.timestamp);
                    
                    const weightHistoryText = weightEntries.map(entry => {
                        const date = new Date(entry.timestamp).toLocaleDateString('vi-VN');
                        return `${date}: ${entry.weight}kg`;
                    }).join('\n');
                    
                    const prompt = `B·∫°n l√† m·ªôt tr·ª£ l√Ω s·ª©c kh·ªèe c√° nh√¢n. D·ª±a tr√™n l·ªãch s·ª≠ c√¢n n·∫∑ng c·ªßa ng∆∞·ªùi d√πng ${USER_NAME}, h√£y ƒë∆∞a ra m·ªôt l·ªùi ph√¢n t√≠ch chi ti·∫øt, t√≠ch c·ª±c, vui nh·ªôn v√† mang t√≠nh ƒë·ªông vi√™n. M·ª•c ti√™u c·ªßa ng∆∞·ªùi d√πng l√† gi·∫£m c√¢n t·ª´ ${START_WEIGHT}kg xu·ªëng c√≤n ${GOAL_WEIGHT_RANGE}kg. Ng∆∞·ªùi d√πng c√≥ v·∫•n ƒë·ªÅ s·ª©c kh·ªèe: ${HEALTH_CONCERNS}, n√™n l·ªùi khuy√™n c·∫ßn nh·∫π nh√†ng v√† an to√†n.
                    
                    D∆∞·ªõi ƒë√¢y l√† l·ªãch s·ª≠ c√¢n n·∫∑ng c·ªßa ${USER_NAME}:
                    ${weightHistoryText}
                    
                    H√£y ph√¢n t√≠ch ti·∫øn ƒë·ªô, ƒë∆∞a ra nh·∫≠n x√©t v·ªÅ s·ª± thay ƒë·ªïi, v√† g·ª£i √Ω nh·ªØng b∆∞·ªõc ti·∫øp theo m·ªôt c√°ch c·ª• th·ªÉ, th√¢n thi·ªán v√† ƒë·ªông vi√™n. ƒê·∫∑c bi·ªát, h√£y chuy·ªÉn ƒë·ªïi k·∫øt qu·∫£ th√†nh m·ªôt ƒë·ªëi t∆∞·ª£ng JSON c√≥ c·∫•u tr√∫c nh∆∞ sau:
                    {
                      "title": "Ti√™u ƒë·ªÅ vui nh·ªôn",
                      "summary": "T√≥m t·∫Øt ng·∫Øn g·ªçn, t√≠ch c·ª±c",
                      "sections": [
                        { "heading": "Ti√™u ƒë·ªÅ ph·∫ßn 1", "content": "N·ªôi dung ph·∫ßn 1", "icon": "bi·ªÉu t∆∞·ª£ng emoji" },
                        { "heading": "Ti√™u ƒë·ªÅ ph·∫ßn 2", "content": "N·ªôi dung ph·∫ßn 2", "icon": "bi·ªÉu t∆∞·ª£ng emoji" }
                      ],
                      "motivationalQuote": "M·ªôt c√¢u n√≥i t·∫°o ƒë·ªông l·ª±c"
                    }
                    `;
                    
                    const payload = { 
                        contents: [{ role: "user", parts: [{ text: prompt }] }],
                        generationConfig: {
                            responseMimeType: "application/json",
                            responseSchema: {
                                "type": "OBJECT",
                                "properties": {
                                    "title": { "type": "STRING" },
                                    "summary": { "type": "STRING" },
                                    "sections": {
                                        "type": "ARRAY",
                                        "items": {
                                            "type": "OBJECT",
                                            "properties": {
                                                "heading": { "type": "STRING" },
                                                "content": { "type": "STRING" },
                                                "icon": { "type": "STRING" }
                                            }
                                        }
                                    },
                                    "motivationalQuote": { "type": "STRING" }
                                }
                            }
                        }
                    };
                    
                    // THAY "YOUR_API_KEY_HERE" B·∫∞NG KH√ìA API C·ª¶A B·∫†N T·ª™ GOOGLE AI STUDIO
                    const apiKey = "AIzaSyC6-hOHavm6hd8Y4u4gK6G2KG9Ev9SPQjs";
                    
                    if (!apiKey || apiKey === "YOUR_API_KEY_HERE") {
                        analysisMessageDiv.innerHTML = '<p class="text-red-600">L·ªói: Vui l√≤ng d√°n kh√≥a API c·ªßa b·∫°n v√†o bi·∫øn `apiKey` trong m√£ ngu·ªìn ƒë·ªÉ s·ª≠ d·ª•ng ch·ª©c nƒÉng n√†y.</p>';
                        analysisMessageDiv.classList.remove('hidden');
                        loadingAnalysisDiv.classList.add('hidden');
                        loadingAnalysisDiv.classList.remove('flex');
                        return;
                    }
                    
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
                    
                    const response = await fetchWithExponentialBackoff(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    
                    const result = await response.json();
                    
                    if (result?.candidates?.[0]?.content?.parts?.[0]?.text) {
                        let jsonText = result.candidates[0].content.parts[0].text;
                        if (jsonText.startsWith("```json") && jsonText.endsWith("```")) {
                            jsonText = jsonText.substring(7, jsonText.length - 3).trim();
                        }

                        try {
                            const analysisData = JSON.parse(jsonText);
                            if (analysisData && analysisData.sections && Array.isArray(analysisData.sections)) {
                                let htmlOutput = `
                                    <div class="space-y-4">
                                        <h3 class="text-xl md:text-2xl font-bold text-indigo-700">${analysisData.title}</h3>
                                        <p class="text-sm text-stone-600">${analysisData.summary}</p>
                                        <div class="space-y-6 mt-4">
                                            ${analysisData.sections.map(section => `
                                                <div class="flex items-start gap-4">
                                                    <span class="text-2xl">${section.icon}</span>
                                                    <div>
                                                        <h4 class="font-semibold text-lg text-indigo-600">${section.heading}</h4>
                                                        <p class="text-stone-700">${section.content}</p>
                                                    </div>
                                                </div>
                                            `).join('')}
                                        </div>
                                        <div class="mt-6 pt-4 border-t-2 border-indigo-200">
                                            <p class="italic text-center font-medium text-indigo-800">"${analysisData.motivationalQuote}"</p>
                                        </div>
                                    </div>
                                `;

                                analysisMessageDiv.innerHTML = htmlOutput;
                                analysisMessageDiv.classList.remove('hidden');
                            } else {
                                throw new Error('L·ªói: D·ªØ li·ªáu ph√¢n t√≠ch t·ª´ AI kh√¥ng h·ª£p l·ªá. Vui l√≤ng th·ª≠ l·∫°i.');
                            }
                        } catch (parseError) {
                            console.error("Failed to parse JSON from API response:", parseError);
                            console.error("Malformed JSON:", jsonText);
                            throw new Error('L·ªói: D·ªØ li·ªáu ph√¢n t√≠ch t·ª´ AI kh√¥ng h·ª£p l·ªá. Vui l√≤ng th·ª≠ l·∫°i.');
                        }
                    } else {
                        throw new Error('C·∫•u tr√∫c ph·∫£n h·ªìi t·ª´ API kh√¥ng mong mu·ªën ho·∫∑c kh√¥ng c√≥ n·ªôi dung.');
                    }
                } catch (error) {
                    console.error("Error calling Gemini API for analysis:", error);
                    analysisMessageDiv.innerHTML = `<p class="text-red-600">${error.message}</p>`;
                    analysisMessageDiv.classList.remove('hidden');
                } finally {
                    loadingAnalysisDiv.classList.add('hidden');
                    loadingAnalysisDiv.classList.remove('flex');
                }
            }

            document.getElementById('save-weight-btn').addEventListener('click', () => {
                const weightInput = document.getElementById('weight-input');
                const weight = parseFloat(weightInput.value);

                if (isNaN(weight) || weight <= 0) {
                    analysisMessageDiv.innerHTML = '<p class="text-red-600">Vui l√≤ng nh·∫≠p m·ªôt s·ªë c√¢n n·∫∑ng h·ª£p l·ªá.</p>';
                    analysisMessageDiv.classList.remove('hidden');
                    return;
                }
                
                // L·∫•y l·ªãch s·ª≠ hi·ªán t·∫°i, th√™m d·ªØ li·ªáu m·ªõi v√† l∆∞u l·∫°i
                const weightEntries = loadWeightHistoryFromLocal();
                weightEntries.push({
                    weight: weight,
                    timestamp: Date.now()
                });
                saveWeightHistoryToLocal(weightEntries);
                
                weightInput.value = '';
                analysisMessageDiv.innerHTML = '<p class="text-gray-600">C√¢n n·∫∑ng ƒë√£ ƒë∆∞·ª£c l∆∞u th√†nh c√¥ng! üí™</p>';
                analysisMessageDiv.classList.remove('hidden');
                console.log("Weight saved successfully!");
                
                // C·∫≠p nh·∫≠t l·∫°i danh s√°ch hi·ªÉn th·ªã
                renderWeightHistory();
            });
            
            document.getElementById('analyze-weight-btn').addEventListener('click', analyzeWeightWithGemini);
            
            document.querySelectorAll('details').forEach(detail => {
                detail.addEventListener('toggle', () => {
                    const icon = detail.querySelector('svg');
                    if (detail.open) {
                        icon.style.transform = 'rotate(90deg)';
                    } else {
                        icon.style.transform = 'rotate(0deg)';
                    }
                });
            });
        });
    </script>
</body>
</html>
